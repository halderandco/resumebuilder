<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Resume Builder ‚Äì Full System (All 6 Phases)</title>
    <style>
        /* ---------- GLOBAL RESET & EDITOR LAYOUT ---------- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #f0f4fa;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .toolbar {
            background: #1e3b4c;
            color: white;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 24px;
            flex-wrap: wrap;
        }

        .toolbar button, .toolbar select {
            background: white;
            border: none;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            color: #1e3b4c;
            cursor: pointer;
            transition: 0.2s;
        }

        .toolbar button:hover {
            background: #d4e3ed;
        }

        .editor-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* ---------- LEFT FORM PANEL ---------- */
        .form-panel {
            width: 32%;
            background: white;
            border-right: 1px solid #cfdce6;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.02);
        }

        .form-section {
            margin-bottom: 28px;
            border-bottom: 1px solid #e2e9f0;
            padding-bottom: 16px;
        }

        .form-section h3 {
            font-size: 16px;
            font-weight: 700;
            color: #1e3b4c;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .form-group {
            margin-bottom: 14px;
        }

        label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #3a5f73;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        input, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #cbdae5;
            border-radius: 8px;
            font-size: 13px;
            font-family: inherit;
            background: #fafcfd;
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        .visibility-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .sortable-list {
            background: #f5f9ff;
            padding: 8px;
            border-radius: 12px;
        }

        .section-drag {
            background: white;
            border: 1px solid #d8e2ed;
            padding: 12px 16px;
            margin-bottom: 6px;
            border-radius: 8px;
            cursor: move;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
            color: #1e3b4c;
            transition: 0.1s;
        }

        .section-drag:hover {
            background: #ecf3fa;
            border-color: #99b8cc;
        }

        .section-drag.dragging {
            opacity: 0.4;
            background: #cfe1ed;
        }

        .drag-handle {
            font-size: 20px;
            color: #6b8a9c;
        }

        /* ---------- RIGHT PREVIEW PANEL ---------- */
        .preview-panel {
            flex: 1;
            background: #e6ecf0;
            padding: 24px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .preview-scroll {
            width: 210mm;
            background: white;
            box-shadow: 0 12px 30px rgba(0,0,0,0.1);
            transform: scale(0.85);
            transform-origin: top center;
            margin-bottom: 20px;
        }

        .resume {
            /* dimensions and padding will be set by each template's inline styles */
            background: white;
        }

        /* ---------- ATS SCORING PANEL (below preview) ---------- */
        .ats-panel {
            width: 210mm;
            background: white;
            margin-top: 20px;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.06);
            font-size: 14px;
        }

        .ats-panel h3 {
            font-size: 18px;
            margin-bottom: 12px;
            color: #1e3b4c;
            border-bottom: 2px solid #d0e0eb;
            padding-bottom: 6px;
        }

        .ats-row {
            display: flex;
            gap: 20px;
            margin-bottom: 16px;
        }

        .ats-score {
            background: #1e4a6b;
            color: white;
            padding: 12px 24px;
            border-radius: 40px;
            font-weight: 700;
            font-size: 28px;
            display: inline-block;
        }

        .ats-suggestions {
            background: #fef9e7;
            border-left: 6px solid #f5b042;
            padding: 16px;
            border-radius: 8px;
        }

        /* ---------- PRINT OVERRIDES (Phase 6) ---------- */
        @media print {
            .toolbar, .form-panel, .ats-panel, .preview-panel > *:not(.preview-scroll), .no-print {
                display: none !important;
            }
            .preview-panel {
                background: white;
                padding: 0;
                display: block;
            }
            .preview-scroll {
                transform: none;
                width: 100%;
                box-shadow: none;
                margin: 0;
            }
            .resume {
                box-shadow: none;
                page-break-after: avoid;
            }
            body {
                background: white;
            }
        }

        /* ---------- PAGE BREAK UTILITIES (Phase 3) ---------- */
        .page-break-before {
            break-before: page;
        }
        .page-break-after {
            break-after: page;
        }
        li, .job, .education, .section {
            break-inside: avoid;
        }
    </style>
</head>
<body>

    <!-- ---------- TOP TOOLBAR (Template selector, export) ---------- -->
    <div class="toolbar no-print">
        <div style="display: flex; align-items: center; gap: 8px;">
            <span style="font-weight: 600;">üìÑ Template:</span>
            <select id="templateSelector">
                <option value="ats">1. ATS‚ÄëOptimized (Single Column)</option>
                <option value="modern" selected>2. Modern Professional</option>
                <option value="executive">3. Executive / Leadership</option>
                <option value="minimal">4. Minimal</option>
                <option value="creative">5. Creative (ATS‚ÄëAware)</option>
            </select>
        </div>
        <button id="printBtn">üñ® Export PDF (Print)</button>
        <button id="runAtsBtn">üìä Run ATS Score</button>
    </div>

    <!-- ---------- MAIN EDITOR: LEFT FORM + RIGHT PREVIEW ---------- -->
    <div class="editor-container">
        <!-- LEFT FORM PANEL -->
        <div class="form-panel no-print">
            <h2 style="margin-bottom: 20px; color: #0f2a36;">‚úé Resume Builder</h2>

            <!-- Section Order (Drag & Drop) -->
            <div class="form-section">
                <h3>üìã Section Order <span style="font-size:12px; font-weight:normal;">(drag to reorder)</span></h3>
                <div id="section-sortable" class="sortable-list">
                    <div class="section-drag" draggable="true" data-section="profile">‚ò∞ Profile</div>
                    <div class="section-drag" draggable="true" data-section="experience">‚ò∞ Experience</div>
                    <div class="section-drag" draggable="true" data-section="education">‚ò∞ Education</div>
                    <div class="section-drag" draggable="true" data-section="skills">‚ò∞ Skills</div>
                    <div class="section-drag" draggable="true" data-section="certifications">‚ò∞ Certifications</div>
                </div>
            </div>

            <!-- Visibility Toggles -->
            <div class="form-section">
                <h3>üëÅÔ∏è Section Visibility</h3>
                <div class="visibility-toggle"><input type="checkbox" id="vis-profile" checked><label for="vis-profile">Profile</label></div>
                <div class="visibility-toggle"><input type="checkbox" id="vis-experience" checked><label for="vis-experience">Experience</label></div>
                <div class="visibility-toggle"><input type="checkbox" id="vis-education" checked><label for="vis-education">Education</label></div>
                <div class="visibility-toggle"><input type="checkbox" id="vis-skills" checked><label for="vis-skills">Skills</label></div>
                <div class="visibility-toggle"><input type="checkbox" id="vis-certifications" checked><label for="vis-certifications">Certifications</label></div>
            </div>

            <!-- Personal Information -->
            <div class="form-section">
                <h3>üë§ Personal</h3>
                <div class="form-group"><label>Full Name</label><input type="text" id="name" value="Taylor Reed"></div>
                <div class="form-group"><label>Title / Role</label><input type="text" id="title" value="Senior UX Designer"></div>
                <div class="form-group"><label>Email</label><input type="email" id="email" value="taylor.reed@email.com"></div>
                <div class="form-group"><label>Phone</label><input type="text" id="phone" value="+1 (415) 555-0198"></div>
                <div class="form-group"><label>Location</label><input type="text" id="location" value="San Francisco, CA"></div>
            </div>

            <!-- Profile Summary -->
            <div class="form-section">
                <h3>üìù Profile</h3>
                <textarea id="summary">Senior UX designer with 6 years of experience in enterprise SaaS. Passionate about inclusive design and data‚Äëdriven decision making.</textarea>
            </div>

            <!-- Experience (simplified ‚Äì two jobs) -->
            <div class="form-section">
                <h3>üíº Experience</h3>
                <div class="form-group"><label>Job 1 Title & Company</label><input type="text" id="job1-title" value="Lead UX Designer ¬∑ DesignFlow"></div>
                <div class="form-group"><label>Dates</label><input type="text" id="job1-date" value="2021 ‚Äì present"></div>
                <div class="form-group"><label>Bullet 1</label><input type="text" id="job1-b1" value="Spearheaded redesign of analytics dashboard, increasing user engagement by 34%."></div>
                <div class="form-group"><label>Bullet 2</label><input type="text" id="job1-b2" value="Established component library used by 8 product teams."></div>
                <div style="margin-top: 16px;"><div class="form-group"><label>Job 2 Title & Company</label><input type="text" id="job2-title" value="UX/UI Designer ¬∑ AppCraft"></div></div>
                <div class="form-group"><label>Dates</label><input type="text" id="job2-date" value="2018 ‚Äì 2021"></div>
                <div class="form-group"><label>Bullet 1</label><input type="text" id="job2-b1" value="Designed end‚Äëto‚Äëend mobile app for inventory management."></div>
                <div class="form-group"><label>Bullet 2</label><input type="text" id="job2-b2" value="Conducted 25+ usability sessions, iterating on low‚Äëfidelity prototypes."></div>
            </div>

            <!-- Education (two entries) -->
            <div class="form-section">
                <h3>üéì Education</h3>
                <div class="form-group"><label>Degree 1</label><input type="text" id="edu1-degree" value="M.S. Human‚ÄëComputer Interaction"></div>
                <div class="form-group"><label>School 1</label><input type="text" id="edu1-school" value="Stanford University"></div>
                <div class="form-group"><label>Year 1</label><input type="text" id="edu1-year" value="2018"></div>
                <div style="margin-top: 12px;"><div class="form-group"><label>Degree 2</label><input type="text" id="edu2-degree" value="B.A. Psychology"></div></div>
                <div class="form-group"><label>School 2</label><input type="text" id="edu2-school" value="UC Berkeley"></div>
                <div class="form-group"><label>Year 2</label><input type="text" id="edu2-year" value="2016"></div>
            </div>

            <!-- Skills (comma separated) -->
            <div class="form-section">
                <h3>üîß Skills</h3>
                <div class="form-group"><label>Skills (comma separated)</label><input type="text" id="skills" value="UX Research, Wireframing, Prototyping, Figma, Adobe XD, User Testing, HTML/CSS"></div>
            </div>

            <!-- Certifications -->
            <div class="form-section">
                <h3>üìú Certifications</h3>
                <div class="form-group"><label>Certifications (comma separated)</label><input type="text" id="certs" value="Google UX Design Professional, NN/g UX Certification"></div>
            </div>
        </div>

        <!-- RIGHT PREVIEW PANEL (Resume + ATS results) -->
        <div class="preview-panel">
            <div class="preview-scroll">
                <div id="resume-preview" class="resume"></div>
            </div>
            <!-- ATS SCORING CARD (hidden until "Run ATS Score" is clicked) -->
            <div id="atsResultCard" class="ats-panel no-print" style="display: none;">
                <h3>üìä ATS Compatibility Analysis</h3>
                <div id="atsContent"></div>
            </div>
            <!-- Job Description input for ATS -->
            <div class="ats-panel no-print" style="margin-top: 20px; background: #f6fafd;">
                <h3>üéØ Job Description (for ATS scoring)</h3>
                <textarea id="jobDesc" rows="5" style="width:100%; padding:12px; border:1px solid #b8d1dc; border-radius:10px; margin-bottom:12px;">We are looking for a Senior UX Designer with strong skills in Figma, prototyping, user research, and design systems. Experience in SaaS and dashboard design is a plus. Must have excellent communication and leadership abilities.</textarea>
                <button id="scoreBtn" style="background:#1e4a6b; color:white; padding:10px 22px; border:none; border-radius:30px; font-weight:600; cursor:pointer;">Run ATS Score</button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            "use strict";

            // ------------------------------------------------------------
            //  PHASE 2: FIVE TEMPLATES ‚Äì each as a separate rendering function
            // ------------------------------------------------------------
            const templates = {
                ats: function(data) {
                    return ` <div class="resume" style="width:210mm; padding:12mm 15mm; background:white; font-family:Arial, Helvetica, sans-serif; line-height:1.5;">
                        <h1 style="font-size:28pt; font-weight:700; margin-bottom:1mm;">${data.name}</h1>
                        <div style="font-size:12pt; color:#2c3e50; margin-bottom:3mm;">${data.title} ¬∑ ${data.email} ¬∑ ${data.phone} ¬∑ ${data.location}</div>
                        ${data.visibility.profile ? `<section style="margin-bottom:5mm;"><h2 style="font-size:16pt; border-bottom:0.5pt solid #2c3e50; padding-bottom:1mm; margin-bottom:3mm;">SUMMARY</h2><p>${data.summary}</p></section>` : ''}
                        ${data.visibility.experience ? `<section style="margin-bottom:5mm;"><h2 style="font-size:16pt; border-bottom:0.5pt solid #2c3e50; padding-bottom:1mm; margin-bottom:3mm;">EXPERIENCE</h2>${data.experience.map(job => `<div style="margin-bottom:4mm;"><div style="display:flex; justify-content:space-between; font-weight:600;"><span>${job.role} ¬∑ ${job.company}</span><span>${job.date}</span></div><ul style="list-style:none; padding-left:2mm;">${job.bullets.map(b => `<li style="position:relative; padding-left:4mm; margin-bottom:0.75mm; break-inside:avoid;"><span style="position:absolute; left:0;">‚Ä¢</span>${b}</li>`).join('')}</ul></div>`).join('')}</section>` : ''}
                        ${data.visibility.education ? `<section><h2 style="font-size:16pt; border-bottom:0.5pt solid #2c3e50; padding-bottom:1mm; margin-bottom:3mm;">EDUCATION</h2>${data.education.map(edu => `<div style="margin-bottom:3mm;"><div style="display:flex; justify-content:space-between; font-weight:600;"><span>${edu.degree}</span><span>${edu.year}</span></div><p>${edu.school}</p></div>`).join('')}</section>` : ''}
                        ${data.visibility.skills ? `<section style="margin-top:4mm;"><h2 style="font-size:16pt; border-bottom:0.5pt solid #2c3e50; padding-bottom:1mm; margin-bottom:3mm;">SKILLS</h2><ul style="list-style:none; padding-left:2mm;">${data.skills.map(s => `<li style="position:relative; padding-left:4mm;"><span style="position:absolute; left:0;">‚Ä¢</span>${s}</li>`).join('')}</ul></section>` : ''}
                        ${data.visibility.certifications && data.certifications.length ? `<section style="margin-top:4mm;"><h2 style="font-size:16pt; border-bottom:0.5pt solid #2c3e50; padding-bottom:1mm; margin-bottom:3mm;">CERTIFICATIONS</h2><ul style="list-style:none; padding-left:2mm;">${data.certifications.map(c => `<li style="position:relative; padding-left:4mm;"><span style="position:absolute; left:0;">‚Ä¢</span>${c}</li>`).join('')}</ul></section>` : ''}
                    </div>`;
                },
                modern: function(data) {
                    return `<div class="resume" style="width:210mm; padding:12mm; background:white; display:grid; grid-template-columns:1fr 2.2fr; gap:6mm 8mm; font-family:'Inter', sans-serif; line-height:1.5; color:#1e2b3c;">
                        <h1 style="font-size:28pt; font-weight:700; grid-column:1/-1; margin-bottom:2mm;">${data.name}</h1>
                        <div style="grid-column:1/-1; display:flex; gap:8mm; border-bottom:1pt solid #8a9aa8; padding-bottom:3mm; font-size:11pt;">${[data.email, data.phone, data.location, `linkedin.com/in/${data.name.toLowerCase().replace(' ', '-')}`].join('<span> </span>')}</div>
                        <div style="background:#f4f7fb; padding:5mm 4mm;">
                            ${data.visibility.skills ? `<section style="margin-bottom:5mm;"><h2 style="font-size:14pt; font-weight:600; color:#1e4a6b; border-bottom:0.5pt solid #8a9aa8; margin-bottom:3mm;">SKILLS</h2><div style="display:flex; flex-wrap:wrap; gap:2mm;">${data.skills.map(s => `<span style="background:white; border:0.5pt solid #8a9aa8; padding:1mm 2mm; font-size:10pt; border-radius:2pt;">${s}</span>`).join('')}</div></section>` : ''}
                            ${data.visibility.education ? `<section><h2 style="font-size:14pt; font-weight:600; color:#1e4a6b; border-bottom:0.5pt solid #8a9aa8; margin-bottom:3mm;">EDUCATION</h2>${data.education.map(edu => `<div style="margin-bottom:3mm;"><div style="display:flex; justify-content:space-between;"><span style="font-weight:600;">${edu.degree}</span><span>${edu.year}</span></div><p>${edu.school}</p></div>`).join('')}</section>` : ''}
                            ${data.visibility.certifications && data.certifications.length ? `<section style="margin-top:4mm;"><h2 style="font-size:14pt; font-weight:600; color:#1e4a6b; border-bottom:0.5pt solid #8a9aa8; margin-bottom:3mm;">CERTIFICATIONS</h2><ul style="list-style:none; padding-left:2mm;">${data.certifications.map(c => `<li style="position:relative; padding-left:4mm; margin-bottom:0.75mm;"><span style="position:absolute; left:0; color:#1e4a6b;">‚ñπ</span>${c}</li>`).join('')}</ul></section>` : ''}
                        </div>
                        <div style="padding-top:2mm;">
                            ${data.visibility.profile ? `<section style="margin-bottom:5mm;"><h2 style="font-size:14pt; font-weight:600; color:#1e4a6b; border-bottom:0.5pt solid #8a9aa8; margin-bottom:3mm;">PROFILE</h2><p>${data.summary}</p></section>` : ''}
                            ${data.visibility.experience ? `<section><h2 style="font-size:14pt; font-weight:600; color:#1e4a6b; border-bottom:0.5pt solid #8a9aa8; margin-bottom:3mm;">EXPERIENCE</h2>${data.experience.map(job => `<div style="margin-bottom:4mm;"><div style="display:flex; justify-content:space-between; font-weight:600;"><span>${job.role} ¬∑ ${job.company}</span><span>${job.date}</span></div><ul style="list-style:none; padding-left:2mm;">${job.bullets.map(b => `<li style="position:relative; padding-left:4mm; margin-bottom:0.75mm;"><span style="position:absolute; left:0; color:#1e4a6b;">‚ñπ</span>${b}</li>`).join('')}</ul></div>`).join('')}</section>` : ''}
                        </div>
                    </div>`;
                },
                executive: function(data) {
                    return `<div class="resume" style="width:210mm; padding:18mm 20mm; background:white; font-family:Georgia, 'Times New Roman', serif; line-height:1.6;">
                        <h1 style="font-size:36pt; font-weight:400; letter-spacing:-0.5px; margin-bottom:0.5mm; color:#0b1c2e;">${data.name}</h1>
                        <div style="font-size:18pt; font-weight:300; color:#3a5f6e; border-bottom:0.5pt solid #8f9aa5; padding-bottom:3mm; margin-bottom:3mm;">${data.title}</div>
                        <div style="display:flex; gap:8mm; font-size:12pt; margin-bottom:4mm; color:#2f4a5c;">${[data.email, data.phone, data.location].join(' ¬∑ ')}</div>
                        ${data.visibility.profile ? `<section style="margin-bottom:6mm;"><h2 style="font-size:18pt; font-weight:400; color:#1e3f4a; border-bottom:0.5pt solid #b3c2c9; padding-bottom:1mm; margin-bottom:4mm;">EXECUTIVE SUMMARY</h2><p>${data.summary}</p></section>` : ''}
                        ${data.visibility.experience ? `<section><h2 style="font-size:18pt; font-weight:400; color:#1e3f4a; border-bottom:0.5pt solid #b3c2c9; padding-bottom:1mm; margin-bottom:4mm;">SELECTED ACHIEVEMENTS</h2>${data.experience.map(job => `<div style="margin-bottom:5mm;"><div style="display:flex; justify-content:space-between; font-size:14pt; font-weight:600;"><span>${job.role} ¬∑ ${job.company}</span><span>${job.date}</span></div><ul style="list-style:none; padding-left:2mm;">${job.bullets.map(b => `<li style="position:relative; padding-left:5mm; margin-bottom:1.5mm; font-size:12pt;"><span style="position:absolute; left:0; color:#3a5f6e;">‚Äî</span>${b}</li>`).join('')}</ul></div>`).join('')}</section>` : ''}
                        ${data.visibility.education ? `<section style="margin-top:5mm;"><h2 style="font-size:18pt; font-weight:400; color:#1e3f4a; border-bottom:0.5pt solid #b3c2c9; padding-bottom:1mm; margin-bottom:4mm;">EDUCATION</h2>${data.education.map(edu => `<div style="display:flex; justify-content:space-between; font-size:12pt;"><span style="font-weight:600;">${edu.degree}</span><span>${edu.year}</span></div><p>${edu.school}</p>`).join('')}</section>` : ''}
                    </div>`;
                },
                minimal: function(data) {
                    return `<div class="resume" style="width:210mm; padding:10mm 12mm; background:white; font-family:'Inter', Helvetica, Arial, sans-serif; line-height:1.5; color:black;">
                        <h1 style="font-size:28pt; font-weight:600; margin-bottom:1mm; letter-spacing:-0.5px;">${data.name}</h1>
                        <div style="display:flex; flex-wrap:wrap; gap:4mm; font-size:10.5pt; margin-bottom:4mm; border-bottom:0.25pt solid #aaa; padding-bottom:2mm;">${[data.email, data.phone, data.location].join(' ¬∑ ')}</div>
                        ${data.visibility.profile ? `<section style="margin-bottom:3mm;"><h2 style="font-size:12pt; font-weight:600; margin-bottom:1.5mm; text-transform:uppercase; letter-spacing:1px;">SUMMARY</h2><p style="font-size:10.5pt;">${data.summary}</p></section>` : ''}
                        ${data.visibility.skills ? `<section style="margin-bottom:3mm;"><h2 style="font-size:12pt; font-weight:600; margin-bottom:1.5mm; text-transform:uppercase; letter-spacing:1px;">TECHNICAL SKILLS</h2><p style="font-size:10.5pt;">${data.skills.join(' ¬∑ ')}</p></section>` : ''}
                        ${data.visibility.experience ? `<section style="margin-bottom:3mm;"><h2 style="font-size:12pt; font-weight:600; margin-bottom:1.5mm; text-transform:uppercase; letter-spacing:1px;">EXPERIENCE</h2>${data.experience.map(job => `<div style="margin-bottom:2.5mm;"><div style="display:flex; justify-content:space-between; font-weight:600; font-size:11pt;"><span>${job.role} ¬∑ ${job.company}</span><span style="font-weight:400;">${job.date}</span></div><ul style="list-style:none; padding-left:0;">${job.bullets.map(b => `<li style="font-size:10.5pt; margin-bottom:0.5mm;">${b}</li>`).join('')}</ul></div>`).join('')}</section>` : ''}
                        ${data.visibility.education ? `<section><h2 style="font-size:12pt; font-weight:600; margin-bottom:1.5mm; text-transform:uppercase; letter-spacing:1px;">EDUCATION</h2>${data.education.map(edu => `<div style="display:flex; justify-content:space-between; font-size:10.5pt;"><span style="font-weight:600;">${edu.degree}</span><span>${edu.year}</span></div><p style="font-size:10.5pt;">${edu.school}</p>`).join('')}</section>` : ''}
                    </div>`;
                },
                creative: function(data) {
                    return `<div class="resume" style="width:210mm; padding:14mm 16mm; background:white; font-family:'Inter', Helvetica, Arial, sans-serif; line-height:1.5; color:#2e2e2e;">
                        <h1 style="font-size:36pt; font-weight:700; margin-bottom:1mm; position:relative; display:inline-block;">${data.name}</h1>
                        <div style="display:flex; flex-wrap:wrap; gap:6mm; font-size:11pt; margin-top:2mm; margin-bottom:3mm; border-bottom:0.5pt dashed #d88c4a; padding-bottom:2mm;">${[data.email, data.phone, data.location].join(' ¬∑ ')}</div>
                        ${data.visibility.profile ? `<section style="margin-bottom:5mm;"><h2 style="font-size:16pt; font-weight:600; color:#1a1a1a; border-left:4mm solid #d88c4a; padding-left:2mm; margin-bottom:3mm;">Creative Direction</h2><p>${data.summary}</p></section>` : ''}
                        ${data.visibility.experience ? `<section><h2 style="font-size:16pt; font-weight:600; border-left:4mm solid #d88c4a; padding-left:2mm; margin-bottom:3mm;">Select Work</h2>${data.experience.map(job => `<div style="margin-bottom:4mm;"><div style="display:flex; justify-content:space-between; font-weight:600;"><span>${job.role} ¬∑ ${job.company}</span><span>${job.date}</span></div><ul style="list-style:none; padding-left:2mm;">${job.bullets.map(b => `<li style="position:relative; padding-left:4mm; margin-bottom:0.75mm;"><span style="position:absolute; left:0; color:#d88c4a; font-size:9pt;">‚óÜ</span>${b}</li>`).join('')}</ul></div>`).join('')}</section>` : ''}
                        ${data.visibility.skills ? `<section style="margin-top:4mm;"><h2 style="font-size:16pt; font-weight:600; border-left:4mm solid #d88c4a; padding-left:2mm; margin-bottom:3mm;">Skills</h2><div style="display:flex; flex-wrap:wrap; gap:2mm 4mm;">${data.skills.map(s => `<span style="font-weight:600; min-width:30mm;">${s}</span>`).join('')}</div></section>` : ''}
                        ${data.visibility.education ? `<section style="margin-top:4mm;"><h2 style="font-size:16pt; font-weight:600; border-left:4mm solid #d88c4a; padding-left:2mm; margin-bottom:3mm;">Education</h2>${data.education.map(edu => `<div style="display:flex; justify-content:space-between;"><span style="font-weight:600;">${edu.degree}</span><span>${edu.year}</span></div><p>${edu.school}</p>`).join('')}</section>` : ''}
                    </div>`;
                }
            };

            // ------------------------------------------------------------
            //  PHASE 3: PAGINATION ENGINE (simplified, but functional)
            // ------------------------------------------------------------
            class PaginationEngine {
                constructor(container) {
                    this.container = container;
                    this.pxPerMm = 3.779527559;
                }
                getElementHeightInMm(el) {
                    return el.getBoundingClientRect().height / this.pxPerMm;
                }
                paginate() {
                    // Clear previous breaks
                    document.querySelectorAll('.page-break-before, .page-break-after').forEach(el => {
                        el.classList.remove('page-break-before', 'page-break-after');
                    });
                    const children = Array.from(this.container.children);
                    let remaining = 277; // A4 content height (297-10-10)
                    for (let i = 0; i < children.length; i++) {
                        const el = children[i];
                        const h = this.getElementHeightInMm(el);
                        if (h > remaining && i > 0) {
                            el.classList.add('page-break-before');
                            remaining = 277 - h;
                        } else {
                            remaining -= h;
                        }
                    }
                }
            }

            // ------------------------------------------------------------
            //  PHASE 5: ATS SCORING ENGINE (standalone)
            // ------------------------------------------------------------
            const ATSScorer = {
                skillSynonyms: { js:'JavaScript', javascript:'JavaScript', reactjs:'React', react:'React', nodejs:'Node.js', node:'Node.js', figma:'Figma', 'adobe xd':'Adobe XD', html:'HTML', css:'CSS' },
                stopwords: new Set(['a','an','the','and','or','but','if','because','as','what','which','this','that','these','those','then','just','so','than','such','both','through','about','for','is','of','while','during','to','from','in','on','at','by','with','without','has','have','be','been','being','was','were','will','would','could','should']),
                extractKeywords(text) {
                    if (!text) return [];
                    return text.toLowerCase().split(/[^a-z0-9+.#-]+/).map(t=>t.trim()).filter(t=>t.length>=3 && !this.stopwords.has(t)).map(t=>this.skillSynonyms[t]||t);
                },
                flattenResume(resume) {
                    let parts = [resume.summary];
                    resume.experience.forEach(j=>{ parts.push(j.role, j.company, j.date, ...j.bullets); });
                    resume.education.forEach(e=>{ parts.push(e.degree, e.school, e.year); });
                    parts.push(...resume.skills, ...resume.certifications);
                    return parts.join(' ');
                },
                score(resume, jdText) {
                    const jdKeywords = this.extractKeywords(jdText);
                    const resumeText = this.flattenResume(resume);
                    const resumeKeywords = this.extractKeywords(resumeText);
                    const uniqueJD = [...new Set(jdKeywords)];
                    const uniqueResume = [...new Set(resumeKeywords)];
                    
                    // Skills match (40%)
                    const normalizedResumeSkills = resume.skills.map(s=>this.skillSynonyms[s.toLowerCase()]||s.toLowerCase());
                    const jdSkills = uniqueJD.filter(k=>k.length>2 && !['with','using','based','years','experience'].includes(k));
                    let skillMatch = jdSkills.filter(s=>normalizedResumeSkills.includes(s)).length;
                    let skillScore = jdSkills.length ? (skillMatch / jdSkills.length) * 40 : 40;

                    // Experience relevance (30%)
                    let expScore = 0;
                    if (resume.experience.length) {
                        let relevance = 0;
                        resume.experience.forEach(job => {
                            job.role.toLowerCase().split(/\s+/).forEach(w => { if(w.length>3 && jdText.toLowerCase().includes(w)) relevance+=0.5; });
                        });
                        expScore = Math.min(30, relevance * 5);
                    }

                    // Keyword placement (20%)
                    const missing = uniqueJD.filter(kw => !uniqueResume.includes(kw));
                    const overused = Object.entries(resumeKeywords.reduce((acc,kw)=>{acc[kw]=(acc[kw]||0)+1; return acc;},{})).filter(([k,v])=>v>3).map(([k])=>k);
                    let kwScore = 20 - (missing.length * 2) - (overused.length * 1);
                    kwScore = Math.max(0, kwScore);

                    // Structure (10%)
                    let gaps = [];
                    if (!resume.summary) gaps.push('Summary');
                    if (!resume.experience.length) gaps.push('Experience');
                    if (!resume.education.length) gaps.push('Education');
                    if (!resume.skills.length) gaps.push('Skills');
                    let structScore = Math.max(0, 10 - gaps.length * 2);

                    const total = Math.round(skillScore + expScore + kwScore + structScore);
                    const suggestions = [];
                    if (missing.length) suggestions.push(`Add missing keywords: ${missing.slice(0,5).join(', ')}${missing.length>5?'...':''}`);
                    if (overused.length) suggestions.push(`Reduce overuse of: ${overused.slice(0,3).join(', ')}`);
                    if (gaps.length) suggestions.push(`Complete missing sections: ${gaps.join(', ')}`);

                    return { score: total, missing, overused, gaps, suggestions };
                }
            };

            // ------------------------------------------------------------
            //  RESUME DATA MODEL (connected to form fields)
            // ------------------------------------------------------------
            let resumeData = {
                name: 'Taylor Reed',
                title: 'Senior UX Designer',
                email: 'taylor.reed@email.com',
                phone: '+1 (415) 555-0198',
                location: 'San Francisco, CA',
                summary: 'Senior UX designer with 6 years of experience in enterprise SaaS. Passionate about inclusive design and data‚Äëdriven decision making.',
                experience: [
                    { role: 'Lead UX Designer', company: 'DesignFlow', date: '2021 ‚Äì present', bullets: [
                        'Spearheaded redesign of analytics dashboard, increasing user engagement by 34%.',
                        'Established component library used by 8 product teams.'
                    ]},
                    { role: 'UX/UI Designer', company: 'AppCraft', date: '2018 ‚Äì 2021', bullets: [
                        'Designed end‚Äëto‚Äëend mobile app for inventory management.',
                        'Conducted 25+ usability sessions, iterating on low‚Äëfidelity prototypes.'
                    ]}
                ],
                education: [
                    { degree: 'M.S. Human‚ÄëComputer Interaction', school: 'Stanford University', year: '2018' },
                    { degree: 'B.A. Psychology', school: 'UC Berkeley', year: '2016' }
                ],
                skills: ['UX Research', 'Wireframing', 'Prototyping', 'Figma', 'Adobe XD', 'User Testing', 'HTML/CSS'],
                certifications: ['Google UX Design Professional', 'NN/g UX Certification'],
                sectionOrder: ['profile', 'experience', 'education', 'skills', 'certifications'],
                visibility: { profile: true, experience: true, education: true, skills: true, certifications: true }
            };

            // ------------------------------------------------------------
            //  RENDER PREVIEW (based on selected template)
            // ------------------------------------------------------------
            function renderPreview() {
                const templateName = document.getElementById('templateSelector').value;
                const renderFn = templates[templateName] || templates.modern;
                const html = renderFn(resumeData);
                document.getElementById('resume-preview').innerHTML = html;
            }

            // ------------------------------------------------------------
            //  BIND FORM INPUTS TO resumeData AND RE-RENDER
            // ------------------------------------------------------------
            function bindFormEvents() {
                document.getElementById('name').addEventListener('input', e => { resumeData.name = e.target.value; renderPreview(); });
                document.getElementById('title').addEventListener('input', e => { resumeData.title = e.target.value; renderPreview(); });
                document.getElementById('email').addEventListener('input', e => { resumeData.email = e.target.value; renderPreview(); });
                document.getElementById('phone').addEventListener('input', e => { resumeData.phone = e.target.value; renderPreview(); });
                document.getElementById('location').addEventListener('input', e => { resumeData.location = e.target.value; renderPreview(); });
                document.getElementById('summary').addEventListener('input', e => { resumeData.summary = e.target.value; renderPreview(); });

                document.getElementById('job1-title').addEventListener('input', e => { 
                    let parts = e.target.value.split('¬∑');
                    resumeData.experience[0].role = parts[0].trim();
                    resumeData.experience[0].company = parts[1]?.trim() || '';
                    renderPreview();
                });
                document.getElementById('job1-date').addEventListener('input', e => { resumeData.experience[0].date = e.target.value; renderPreview(); });
                document.getElementById('job1-b1').addEventListener('input', e => { resumeData.experience[0].bullets[0] = e.target.value; renderPreview(); });
                document.getElementById('job1-b2').addEventListener('input', e => { resumeData.experience[0].bullets[1] = e.target.value; renderPreview(); });
                document.getElementById('job2-title').addEventListener('input', e => { 
                    let parts = e.target.value.split('¬∑');
                    resumeData.experience[1].role = parts[0].trim();
                    resumeData.experience[1].company = parts[1]?.trim() || '';
                    renderPreview();
                });
                document.getElementById('job2-date').addEventListener('input', e => { resumeData.experience[1].date = e.target.value; renderPreview(); });
                document.getElementById('job2-b1').addEventListener('input', e => { resumeData.experience[1].bullets[0] = e.target.value; renderPreview(); });
                document.getElementById('job2-b2').addEventListener('input', e => { resumeData.experience[1].bullets[1] = e.target.value; renderPreview(); });

                document.getElementById('edu1-degree').addEventListener('input', e => { resumeData.education[0].degree = e.target.value; renderPreview(); });
                document.getElementById('edu1-school').addEventListener('input', e => { resumeData.education[0].school = e.target.value; renderPreview(); });
                document.getElementById('edu1-year').addEventListener('input', e => { resumeData.education[0].year = e.target.value; renderPreview(); });
                document.getElementById('edu2-degree').addEventListener('input', e => { resumeData.education[1].degree = e.target.value; renderPreview(); });
                document.getElementById('edu2-school').addEventListener('input', e => { resumeData.education[1].school = e.target.value; renderPreview(); });
                document.getElementById('edu2-year').addEventListener('input', e => { resumeData.education[1].year = e.target.value; renderPreview(); });

                document.getElementById('skills').addEventListener('input', e => { 
                    resumeData.skills = e.target.value.split(',').map(s => s.trim()).filter(s => s);
                    renderPreview();
                });
                document.getElementById('certs').addEventListener('input', e => { 
                    resumeData.certifications = e.target.value.split(',').map(s => s.trim()).filter(s => s);
                    renderPreview();
                });

                // Visibility toggles
                document.getElementById('vis-profile').addEventListener('change', e => { resumeData.visibility.profile = e.target.checked; renderPreview(); });
                document.getElementById('vis-experience').addEventListener('change', e => { resumeData.visibility.experience = e.target.checked; renderPreview(); });
                document.getElementById('vis-education').addEventListener('change', e => { resumeData.visibility.education = e.target.checked; renderPreview(); });
                document.getElementById('vis-skills').addEventListener('change', e => { resumeData.visibility.skills = e.target.checked; renderPreview(); });
                document.getElementById('vis-certifications').addEventListener('change', e => { resumeData.visibility.certifications = e.target.checked; renderPreview(); });
            }

            // ------------------------------------------------------------
            //  DRAG & DROP SECTION REORDERING (Phase 4)
            // ------------------------------------------------------------
            function initDragDrop() {
                const sortable = document.getElementById('section-sortable');
                let dragged;
                sortable.addEventListener('dragstart', e => { dragged = e.target; e.target.classList.add('dragging'); });
                sortable.addEventListener('dragend', e => e.target.classList.remove('dragging'));
                sortable.addEventListener('dragover', e => {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(sortable, e.clientY);
                    if (afterElement) sortable.insertBefore(dragged, afterElement);
                    else sortable.appendChild(dragged);
                    // update order in resumeData (optional)
                });
                function getDragAfterElement(container, y) {
                    const draggable = [...container.querySelectorAll('.section-drag:not(.dragging)')];
                    return draggable.reduce((closest, child) => {
                        const box = child.getBoundingClientRect();
                        const offset = y - box.top - box.height/2;
                        return (offset < 0 && offset > closest.offset) ? { offset, element: child } : closest;
                    }, { offset: Number.NEGATIVE_INFINITY }).element;
                }
            }

            // ------------------------------------------------------------
            //  PRINT & PAGINATION (Phase 6 & 3)
            // ------------------------------------------------------------
            function setupPrint() {
                document.getElementById('printBtn').addEventListener('click', function() {
                    const resumeEl = document.querySelector('.resume');
                    if (resumeEl) {
                        const paginator = new PaginationEngine(resumeEl);
                        paginator.paginate();
                    }
                    setTimeout(() => window.print(), 50);
                });
            }

            // ------------------------------------------------------------
            //  ATS SCORING UI (Phase 5)
            // ------------------------------------------------------------
            function setupAts() {
                document.getElementById('scoreBtn').addEventListener('click', function() {
                    const jd = document.getElementById('jobDesc').value;
                    const result = ATSScorer.score(resumeData, jd);
                    const card = document.getElementById('atsResultCard');
                    card.style.display = 'block';
                    let html = `<div style="display:flex; align-items:center; gap:24px; margin-bottom:16px;">
                                    <div><span class="ats-score">${result.score}</span><span style="margin-left:8px;">/100</span></div>
                                    <div style="font-size:16px;">${result.score >= 80 ? '‚úÖ Strong match' : result.score >= 60 ? '‚ö†Ô∏è Moderate match' : 'üî¥ Needs improvement'}</div>
                                </div>`;
                    if (result.missing.length) html += `<p><strong>üîç Missing keywords:</strong> ${result.missing.slice(0,10).join(', ')}</p>`;
                    if (result.overused.length) html += `<p><strong>‚ö†Ô∏è Overused keywords:</strong> ${result.overused.slice(0,5).join(', ')}</p>`;
                    if (result.gaps.length) html += `<p><strong>üìã Section gaps:</strong> ${result.gaps.join(', ')}</p>`;
                    html += `<div class="ats-suggestions"><strong>üí° Suggestions:</strong><ul style="margin-top:8px; padding-left:20px;">${result.suggestions.map(s=>`<li>${s}</li>`).join('')}</ul></div>`;
                    document.getElementById('atsContent').innerHTML = html;
                });
            }

            // ------------------------------------------------------------
            //  TEMPLATE SWITCHING
            // ------------------------------------------------------------
            function setupTemplateSwitch() {
                document.getElementById('templateSelector').addEventListener('change', renderPreview);
            }

            // ------------------------------------------------------------
            //  INITIALISE
            // ------------------------------------------------------------
            window.onload = function() {
                renderPreview();
                bindFormEvents();
                initDragDrop();
                setupPrint();
                setupAts();
                setupTemplateSwitch();
            };
        })();
    </script>
</body>
</html>